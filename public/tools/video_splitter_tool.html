<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Splitter Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b4e 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: rgba(15, 15, 35, 0.95); border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); }
        h1 { color: #e0e7ff; margin-bottom: 10px; font-size: 2.2em; text-align: center; text-shadow: 0 0 30px rgba(139, 92, 246, 0.5); letter-spacing: 2px; }
        .subtitle { color: #a5b4fc; text-align: center; margin-bottom: 40px; font-size: 0.95em; }
        .step { margin-bottom: 30px; padding: 25px; background: rgba(30, 30, 60, 0.6); border-radius: 15px; border-left: 5px solid #8b5cf6; }
        .step h2 { color: #c4b5fd; margin-bottom: 15px; font-size: 1.4em; }
        .upload-area { border: 3px dashed #8b5cf6; border-radius: 15px; padding: 40px; text-align: center; background: rgba(139, 92, 246, 0.05); cursor: pointer; transition: all 0.3s ease; }
        .upload-area:hover { background: rgba(139, 92, 246, 0.15); border-color: #a78bfa; box-shadow: 0 0 30px rgba(139, 92, 246, 0.2); }
        .upload-area.dragover { background: rgba(139, 92, 246, 0.2); border-color: #c4b5fd; transform: scale(1.02); }
        .upload-icon { font-size: 3em; margin-bottom: 15px; }
        #fileInput { display: none; }
        .settings { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .setting-group { display: flex; flex-direction: column; }
        label { color: #c4b5fd; font-weight: 600; margin-bottom: 8px; font-size: 0.95em; }
        input[type="number"] { padding: 12px; border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 8px; font-size: 1em; background: rgba(30, 30, 60, 0.8); color: #e0e7ff; font-family: 'Courier New', monospace; }
        input[type="number"]:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 15px rgba(139, 92, 246, 0.3); }
        button { padding: 15px 30px; border: none; border-radius: 10px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; width: 100%; font-family: 'Courier New', monospace; }
        .split-btn { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 50%, #ec4899 100%); color: white; margin-top: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .split-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 25px rgba(139, 92, 246, 0.5); }
        .split-btn:disabled { background: #374151; cursor: not-allowed; color: #6b7280; }
        .info-box { background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
        .info-box.visible { display: block; }
        .info-box p { margin: 8px 0; color: #93c5fd; }
        .progress-bar { width: 100%; height: 30px; background: rgba(30, 30, 60, 0.8); border-radius: 15px; overflow: hidden; margin: 20px 0; display: none; border: 1px solid rgba(139, 92, 246, 0.3); }
        .progress-bar.visible { display: block; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #8b5cf6 0%, #ec4899 100%); width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9em; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .results { display: none; }
        .results.visible { display: block; }
        .download-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(30, 30, 60, 0.6); border-radius: 10px; margin-bottom: 10px; border: 1px solid rgba(139, 92, 246, 0.2); }
        .download-item.player { background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border-color: #ec4899; }
        .file-info { flex: 1; }
        .file-name { font-weight: 600; color: #e0e7ff; margin-bottom: 5px; }
        .file-size { color: #a5b4fc; font-size: 0.9em; }
        .download-btn { background: #8b5cf6; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; width: auto; }
        .download-btn:hover { background: #7c3aed; box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); }
        .download-all-btn { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 20px; font-size: 1.1em; }
        .download-all-btn:hover { box-shadow: 0 5px 25px rgba(16, 185, 129, 0.4); transform: translateY(-2px); }
        .success-message { background: rgba(16, 185, 129, 0.15); border: 2px solid #10b981; color: #6ee7b7; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; font-weight: 600; }
        .error { background: rgba(239, 68, 68, 0.15); border: 2px solid #ef4444; color: #fca5a5; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; }
        .error.visible { display: block; }
        .instructions { background: rgba(251, 191, 36, 0.1); border-left: 4px solid #fbbf24; padding: 20px; border-radius: 8px; margin-top: 30px; line-height: 1.8; }
        .instructions h3 { color: #fcd34d; margin-bottom: 15px; }
        .instructions ol { margin-left: 20px; }
        .instructions li { margin: 10px 0; color: #fef3c7; }
        .instructions code { background: rgba(251, 191, 36, 0.2); padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; color: #fbbf24; }
        .format-info { display: flex; gap: 10px; margin-top: 10px; justify-content: center; }
        .format-badge { background: rgba(139, 92, 246, 0.2); padding: 5px 15px; border-radius: 20px; color: #c4b5fd; font-size: 0.85em; border: 1px solid rgba(139, 92, 246, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Video Splitter Tool</h1>
        <p class="subtitle">Teile deine Video-Dateien f√ºr Blockchain-Upload</p>
        
        <div class="step">
            <h2>Schritt 1: Video-Datei ausw√§hlen</h2>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üé•</div>
                <div style="font-size: 1.2em; color: #c4b5fd; font-weight: 600; margin-bottom: 10px;">Datei hier ablegen oder klicken</div>
                <div class="format-info">
                    <span class="format-badge">MP4</span>
                    <span class="format-badge">MOV</span>
                </div>
                <input type="file" id="fileInput" accept=".mp4,.mov,video/mp4,video/quicktime">
            </div>
            <div class="info-box" id="fileInfo"></div>
        </div>
        
        <div class="step">
            <h2>Schritt 2: Einstellungen</h2>
            <div class="settings">
                <div class="setting-group">
                    <label for="chunkSize">Chunk-Gr√∂√üe (KB)</label>
                    <input type="number" id="chunkSize" value="390" min="1" max="10000">
                </div>
                <div class="setting-group">
                    <label>Gesch√§tzte Chunks</label>
                    <input type="number" id="estimatedChunks" value="0" disabled style="background: rgba(30, 30, 60, 0.5);">
                </div>
            </div>
            <button class="split-btn" id="splitBtn" disabled>‚ñ∂ Video aufteilen & Player erstellen</button>
        </div>
        
        <div class="error" id="errorBox"></div>
        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill">0%</div>
        </div>
        
        <div class="results" id="results">
            <div class="step">
                <div class="success-message">‚úì Erfolgreich! Dateien sind bereit.</div>
                <h2>Downloads</h2>
                <div id="downloadList"></div>
                <button class="download-all-btn" id="downloadAllBtn">üì¶ Alle als ZIP herunterladen</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üìã Anleitung</h3>
            <ol>
                <li>Video-Datei hochladen (MP4 oder MOV)</li>
                <li>Chunk-Gr√∂√üe einstellen (390 KB f√ºr Bitcoin Ordinals)</li>
                <li>"Aufteilen" klicken</li>
                <li>Player-HTML + alle Chunks herunterladen</li>
                <li>Chunks in Blockchain hochladen (als Inscriptions)</li>
                <li>Player-HTML √∂ffnen und Chunks ausw√§hlen zum Abspielen</li>
            </ol>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        let selectedFile, chunks = [], playerHTML, originalFilename, fileExtension;
        const els = {
            uploadArea: document.getElementById('uploadArea'),
            fileInput: document.getElementById('fileInput'),
            fileInfo: document.getElementById('fileInfo'),
            chunkSize: document.getElementById('chunkSize'),
            estimatedChunks: document.getElementById('estimatedChunks'),
            splitBtn: document.getElementById('splitBtn'),
            progressBar: document.getElementById('progressBar'),
            progressFill: document.getElementById('progressFill'),
            results: document.getElementById('results'),
            downloadList: document.getElementById('downloadList'),
            downloadAllBtn: document.getElementById('downloadAllBtn'),
            errorBox: document.getElementById('errorBox')
        };
        
        els.uploadArea.addEventListener('click', () => els.fileInput.click());
        els.uploadArea.addEventListener('dragover', e => { e.preventDefault(); els.uploadArea.classList.add('dragover'); });
        els.uploadArea.addEventListener('dragleave', () => els.uploadArea.classList.remove('dragover'));
        els.uploadArea.addEventListener('drop', e => { e.preventDefault(); els.uploadArea.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); });
        els.fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });
        els.chunkSize.addEventListener('input', updateEstimate);
        els.splitBtn.addEventListener('click', splitFile);
        els.downloadAllBtn.addEventListener('click', downloadAllAsZip);
        
        function handleFile(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            if (ext !== 'mp4' && ext !== 'mov') return showError('Nur MP4 oder MOV Dateien!');
            selectedFile = file;
            fileExtension = ext;
            originalFilename = file.name.substring(0, file.name.lastIndexOf('.'));
            els.fileInfo.innerHTML = '<p><strong>üìÅ Datei:</strong> ' + file.name + '</p><p><strong>üìä Gr√∂√üe:</strong> ' + formatSize(file.size) + '</p><p><strong>üé¨ Format:</strong> ' + ext.toUpperCase() + '</p>';
            els.fileInfo.classList.add('visible');
            els.splitBtn.disabled = false;
            els.errorBox.classList.remove('visible');
            updateEstimate();
        }
        
        function updateEstimate() {
            if (!selectedFile) return;
            els.estimatedChunks.value = Math.ceil(selectedFile.size / (parseInt(els.chunkSize.value) * 1024));
        }
        
        async function splitFile() {
            els.results.classList.remove('visible');
            els.progressBar.classList.add('visible');
            els.splitBtn.disabled = true;
            chunks = [];
            
            try {
                const chunkSize = parseInt(els.chunkSize.value) * 1024;
                const fileData = await selectedFile.arrayBuffer();
                const totalChunks = Math.ceil(fileData.byteLength / chunkSize);
                
                for (let i = 0; i < totalChunks; i++) {
                    const start = i * chunkSize;
                    const end = Math.min(start + chunkSize, fileData.byteLength);
                    chunks.push({
                        filename: originalFilename + '_part_' + String(i + 1).padStart(3, '0') + '.' + fileExtension,
                        data: fileData.slice(start, end),
                        size: end - start
                    });
                    updateProgress(Math.round(((i + 1) / totalChunks) * 50));
                }
                
                updateProgress(75, 'Player erstellen...');
                playerHTML = createPlayerHTML();
                updateProgress(100);
                displayDownloads();
                setTimeout(() => { els.progressBar.classList.remove('visible'); els.results.classList.add('visible'); }, 500);
            } catch (error) {
                showError('Fehler: ' + error.message);
                els.splitBtn.disabled = false;
            }
        }
        
        function createPlayerHTML() {
            const mime = fileExtension === 'mov' ? 'video/quicktime' : 'video/mp4';
            
            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>' + selectedFile.name + '</title>';
            html += '<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:"Courier New",monospace;background:linear-gradient(135deg,#0f0f23,#1a1a3e,#2d1b4e);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}';
            html += '.container{background:rgba(15,15,35,0.95);border-radius:20px;padding:40px;max-width:900px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.5);border:1px solid rgba(139,92,246,0.3)}';
            html += 'h1{text-align:center;margin-bottom:20px;color:#e0e7ff;text-shadow:0 0 30px rgba(139,92,246,0.5)}';
            html += '.upload{border:3px dashed #8b5cf6;border-radius:15px;padding:40px;text-align:center;background:rgba(139,92,246,0.05);cursor:pointer;margin-bottom:20px;transition:all 0.3s}';
            html += '.upload:hover{background:rgba(139,92,246,0.15)}.upload.hide{display:none}';
            html += '.player-wrap{display:none;flex-direction:column;align-items:center}';
            html += '.player-wrap.show{display:flex}';
            html += 'video{max-width:100%;max-height:60vh;border-radius:15px;background:#000;box-shadow:0 10px 40px rgba(0,0,0,0.5)}';
            html += '.controls{background:rgba(30,30,60,0.8);border-radius:15px;padding:20px;margin-top:20px;width:100%;text-align:center}';
            html += '.progress{width:100%;height:8px;background:rgba(255,255,255,.2);border-radius:4px;margin:15px 0;cursor:pointer;position:relative}';
            html += '.progress-fill{height:100%;background:linear-gradient(90deg,#8b5cf6,#ec4899);width:0%;transition:width .1s;border-radius:4px}';
            html += '.times{display:flex;justify-content:space-between;color:#a5b4fc;font-size:.85em;margin-bottom:10px}';
            html += '.buttons{display:flex;justify-content:center;gap:15px;margin:15px 0}';
            html += 'button{background:rgba(139,92,246,0.3);border:1px solid #8b5cf6;color:#e0e7ff;width:50px;height:50px;border-radius:50%;cursor:pointer;font-size:18px;transition:all 0.3s}';
            html += 'button:hover{background:#8b5cf6;transform:scale(1.1)}.play{width:60px;height:60px;font-size:22px}';
            html += '.status{color:#a5b4fc;margin:10px 0;font-size:0.9em}';
            html += '.vol-wrap{display:flex;align-items:center;gap:10px;justify-content:center;margin-top:10px}';
            html += '.vol-wrap span{color:#a5b4fc;font-size:0.85em}';
            html += 'input[type=range]{width:120px;accent-color:#8b5cf6}';
            html += '.fullscreen-btn{background:linear-gradient(135deg,#ec4899,#8b5cf6);border:none;padding:10px 20px;border-radius:8px;width:auto;height:auto;font-size:0.9em;margin-top:15px}';
            html += '</style></head>';
            html += '<body><div class="container"><h1>üé¨ ' + selectedFile.name + '</h1>';
            html += '<div class="upload" id="upload" onclick="document.getElementById(\'files\').click()"><div style="font-size:3em;margin-bottom:10px">üìÅ</div>';
            html += '<div style="font-size:1.2em;color:#c4b5fd;font-weight:600;margin-bottom:10px">Chunks hier ablegen oder klicken</div>';
            html += '<div style="color:#a5b4fc;font-size:0.9em">W√§hle alle ' + chunks.length + ' Chunk-Dateien aus</div>';
            html += '<input type="file" id="files" multiple accept=".mp4,.mov" style="display:none"></div>';
            html += '<div class="player-wrap" id="playerWrap"><video id="video" playsinline></video>';
            html += '<div class="controls"><div class="times"><span id="curr">0:00</span><span id="total">0:00</span></div>';
            html += '<div class="progress" id="bar"><div class="progress-fill" id="fill"></div></div>';
            html += '<div class="buttons"><button onclick="seek(-10)" title="-10s">‚èÆ</button>';
            html += '<button class="play" id="playBtn" onclick="toggle()">‚ñ∂</button>';
            html += '<button onclick="seek(10)" title="+10s">‚è≠</button></div>';
            html += '<div class="status" id="status">Bereit</div>';
            html += '<div class="vol-wrap"><span>üîä</span><input type="range" id="vol" min="0" max="100" value="100" oninput="video.volume=this.value/100"><span id="volVal">100%</span></div>';
            html += '<button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂ Vollbild</button>';
            html += '</div></div></div>';
            html += '<script>';
            html += 'const MIME="' + mime + '",EXPECTED=' + chunks.length + ';';
            html += 'let playing=false;const video=document.getElementById("video"),els={upload:document.getElementById("upload"),playerWrap:document.getElementById("playerWrap"),playBtn:document.getElementById("playBtn"),fill:document.getElementById("fill"),bar:document.getElementById("bar"),curr:document.getElementById("curr"),total:document.getElementById("total"),status:document.getElementById("status"),files:document.getElementById("files"),vol:document.getElementById("vol"),volVal:document.getElementById("volVal")};';
            html += 'els.upload.addEventListener("dragover",e=>{e.preventDefault();els.upload.style.background="rgba(139,92,246,0.2)"});';
            html += 'els.upload.addEventListener("dragleave",()=>els.upload.style.background="rgba(139,92,246,0.05)");';
            html += 'els.upload.addEventListener("drop",e=>{e.preventDefault();els.upload.style.background="rgba(139,92,246,0.05)";if(e.dataTransfer.files.length>0)handleFiles(e.dataTransfer.files)});';
            html += 'els.files.addEventListener("change",e=>{if(e.target.files.length>0)handleFiles(e.target.files)});';
            html += 'els.vol.addEventListener("input",()=>{els.volVal.textContent=els.vol.value+"%"});';
            html += 'async function handleFiles(files){const vidFiles=Array.from(files).filter(f=>f.name.endsWith(".mp4")||f.name.endsWith(".mov"));';
            html += 'if(vidFiles.length!==EXPECTED){alert("Bitte alle "+EXPECTED+" Chunk-Dateien ausw√§hlen! (Gefunden: "+vidFiles.length+")");return}';
            html += 'vidFiles.sort((a,b)=>a.name.localeCompare(b.name));els.upload.classList.add("hide");els.playerWrap.classList.add("show");';
            html += 'els.status.textContent="Lade "+vidFiles.length+" Chunks...";const chunks=[];';
            html += 'for(let i=0;i<vidFiles.length;i++){const data=await vidFiles[i].arrayBuffer();chunks.push(new Uint8Array(data));els.status.textContent="Geladen: "+(i+1)+"/"+vidFiles.length}';
            html += 'const total=chunks.reduce((s,c)=>s+c.length,0);const merged=new Uint8Array(total);let offset=0;';
            html += 'chunks.forEach(c=>{merged.set(c,offset);offset+=c.length});els.status.textContent="F√ºge zusammen...";';
            html += 'const blob=new Blob([merged],{type:MIME});video.src=URL.createObjectURL(blob);els.status.textContent="Bereit zum Abspielen ‚úì"}';
            html += 'function toggle(){if(playing){video.pause();els.playBtn.textContent="‚ñ∂";playing=false;els.status.textContent="Pausiert"}else{video.play();els.playBtn.textContent="‚è∏";playing=true;els.status.textContent="Spielt ab..."}}';
            html += 'function seek(s){video.currentTime=Math.max(0,Math.min(video.duration,video.currentTime+s))}';
            html += 'function fmt(s){if(isNaN(s))return"0:00";const m=Math.floor(s/60),sec=Math.floor(s%60);return m+":"+(sec<10?"0":"")+sec}';
            html += 'function toggleFullscreen(){if(document.fullscreenElement){document.exitFullscreen()}else{video.requestFullscreen()}}';
            html += 'video.addEventListener("ended",()=>{playing=false;els.playBtn.textContent="‚ñ∂";els.status.textContent="Beendet"});';
            html += 'video.addEventListener("timeupdate",()=>{const p=(video.currentTime/video.duration)*100||0;els.fill.style.width=p+"%";els.curr.textContent=fmt(video.currentTime)});';
            html += 'video.addEventListener("loadedmetadata",()=>els.total.textContent=fmt(video.duration));';
            html += 'els.bar.addEventListener("click",e=>{const r=els.bar.getBoundingClientRect();video.currentTime=((e.clientX-r.left)/r.width)*video.duration});';
            html += 'document.addEventListener("keydown",e=>{if(e.code==="Space"&&video.src){e.preventDefault();toggle()}else if(e.code==="ArrowLeft")seek(-10);else if(e.code==="ArrowRight")seek(10);else if(e.code==="KeyF")toggleFullscreen()});';
            html += 'video.addEventListener("click",toggle);';
            html += '<\/script></body></html>';
            
            return html;
        }
        
        function displayDownloads() {
            var html = '<div class="download-item player"><div class="file-info"><div class="file-name">üé¨ Player: ' + originalFilename + '_player.html</div><div class="file-size">HTML Video Player</div></div>';
            html += '<button class="download-btn" onclick="downloadPlayer()">Download</button></div>';
            
            chunks.forEach((c, i) => {
                html += '<div class="download-item"><div class="file-info"><div class="file-name">üì¶ ' + c.filename + '</div><div class="file-size">' + formatSize(c.size) + '</div></div>';
                html += '<button class="download-btn" onclick="downloadChunk(' + i + ')">Download</button></div>';
            });
            
            els.downloadList.innerHTML = html;
        }
        
        window.downloadPlayer = () => saveAs(new Blob([playerHTML], {type: 'text/html'}), originalFilename + '_player.html');
        window.downloadChunk = i => saveAs(new Blob([chunks[i].data]), chunks[i].filename);
        
        async function downloadAllAsZip() {
            els.downloadAllBtn.disabled = true;
            els.downloadAllBtn.textContent = '‚è≥ Erstelle ZIP...';
            const zip = new JSZip();
            zip.file(originalFilename + '_player.html', playerHTML);
            chunks.forEach(c => zip.file(c.filename, c.data));
            const blob = await zip.generateAsync({type: 'blob'});
            saveAs(blob, originalFilename + '_video_chunks.zip');
            els.downloadAllBtn.disabled = false;
            els.downloadAllBtn.textContent = 'üì¶ Alle als ZIP herunterladen';
        }
        
        function updateProgress(p, t) {
            els.progressFill.style.width = p + '%';
            els.progressFill.textContent = t || p + '%';
        }
        
        function showError(msg) {
            els.errorBox.textContent = '‚ùå ' + msg;
            els.errorBox.classList.add('visible');
            els.progressBar.classList.remove('visible');
        }
        
        function formatSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
