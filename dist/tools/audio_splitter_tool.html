<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Splitter Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
        h1 { color: #333; margin-bottom: 10px; font-size: 2.2em; text-align: center; }
        .subtitle { color: #666; text-align: center; margin-bottom: 40px; }
        .step { margin-bottom: 30px; padding: 25px; background: #f8f9ff; border-radius: 15px; border-left: 5px solid #667eea; }
        .step h2 { color: #667eea; margin-bottom: 15px; font-size: 1.4em; }
        .upload-area { border: 3px dashed #667eea; border-radius: 15px; padding: 40px; text-align: center; background: white; cursor: pointer; transition: all 0.3s ease; }
        .upload-area:hover { background: #f0f2ff; border-color: #764ba2; }
        .upload-area.dragover { background: #e8ebff; border-color: #764ba2; transform: scale(1.02); }
        .upload-icon { font-size: 3em; margin-bottom: 15px; }
        #fileInput { display: none; }
        .settings { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .setting-group { display: flex; flex-direction: column; }
        label { color: #333; font-weight: 600; margin-bottom: 8px; font-size: 0.95em; }
        input[type="number"] { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; }
        input[type="number"]:focus { outline: none; border-color: #667eea; }
        button { padding: 15px 30px; border: none; border-radius: 10px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; width: 100%; }
        .split-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 20px; }
        .split-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .split-btn:disabled { background: #ccc; cursor: not-allowed; }
        .info-box { background: #e8f4f8; border-left: 4px solid #2196F3; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
        .info-box.visible { display: block; }
        .info-box p { margin: 8px 0; color: #333; }
        .progress-bar { width: 100%; height: 30px; background: #f0f0f0; border-radius: 15px; overflow: hidden; margin: 20px 0; display: none; }
        .progress-bar.visible { display: block; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9em; }
        .results { display: none; }
        .results.visible { display: block; }
        .download-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-radius: 10px; margin-bottom: 10px; border: 2px solid #e0e0e0; }
        .download-item.player { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-color: #fdcb6e; }
        .file-info { flex: 1; }
        .file-name { font-weight: 600; color: #333; margin-bottom: 5px; }
        .file-size { color: #666; font-size: 0.9em; }
        .download-btn { background: #667eea; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; width: auto; }
        .download-btn:hover { background: #5568d3; }
        .download-all-btn { background: #4CAF50; color: white; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 20px; font-size: 1.1em; }
        .download-all-btn:hover { background: #45a049; }
        .success-message { background: #d4edda; border: 2px solid #4CAF50; color: #155724; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; font-weight: 600; }
        .error { background: #f8d7da; border: 2px solid #f44336; color: #721c24; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; }
        .error.visible { display: block; }
        .instructions { background: #fff9e6; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px; margin-top: 30px; line-height: 1.8; }
        .instructions h3 { color: #f57c00; margin-bottom: 15px; }
        .instructions ol { margin-left: 20px; }
        .instructions li { margin: 10px 0; color: #333; }
        .instructions code { background: #ffe0b2; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Audio Splitter & Player Generator</h1>
        <p class="subtitle">Teile deine Audio-Dateien f√ºr Blockchain-Upload</p>
        
        <div class="step">
            <h2>Schritt 1: Audio-Datei ausw√§hlen</h2>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üéµ</div>
                <div style="font-size: 1.2em; color: #667eea; font-weight: 600; margin-bottom: 10px;">Datei hier ablegen oder klicken</div>
                <div style="color: #999; font-size: 0.9em;">OGG oder MP3</div>
                <input type="file" id="fileInput" accept=".ogg,.mp3,audio/ogg,audio/mpeg">
            </div>
            <div class="info-box" id="fileInfo"></div>
        </div>
        
        <div class="step">
            <h2>Schritt 2: Einstellungen</h2>
            <div class="settings">
                <div class="setting-group">
                    <label for="chunkSize">Chunk-Gr√∂√üe (KB)</label>
                    <input type="number" id="chunkSize" value="390" min="1" max="10000">
                </div>
                <div class="setting-group">
                    <label>Gesch√§tzte Chunks</label>
                    <input type="number" id="estimatedChunks" value="0" disabled style="background: #f5f5f5;">
                </div>
            </div>
            <button class="split-btn" id="splitBtn" disabled>Datei aufteilen & Player erstellen</button>
        </div>
        
        <div class="error" id="errorBox"></div>
        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill">0%</div>
        </div>
        
        <div class="results" id="results">
            <div class="step">
                <div class="success-message">Erfolgreich! Dateien sind bereit.</div>
                <h2>Downloads</h2>
                <div id="downloadList"></div>
                <button class="download-all-btn" id="downloadAllBtn">Alle als ZIP</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Anleitung</h3>
            <ol>
                <li>Audio-Datei hochladen (OGG/MP3)</li>
                <li>Chunk-Gr√∂√üe einstellen (390 KB f√ºr Bitcoin)</li>
                <li>Aufteilen klicken</li>
                <li>Player-HTML + alle Chunks herunterladen</li>
                <li>Chunks in Blockchain hochladen</li>
                <li>Player-HTML √∂ffnen, <code>const CHUNKS = [...]</code> mit Blockchain-URLs ersetzen</li>
            </ol>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        let selectedFile, chunks = [], playerHTML, originalFilename;
        const els = {
            uploadArea: document.getElementById('uploadArea'),
            fileInput: document.getElementById('fileInput'),
            fileInfo: document.getElementById('fileInfo'),
            chunkSize: document.getElementById('chunkSize'),
            estimatedChunks: document.getElementById('estimatedChunks'),
            splitBtn: document.getElementById('splitBtn'),
            progressBar: document.getElementById('progressBar'),
            progressFill: document.getElementById('progressFill'),
            results: document.getElementById('results'),
            downloadList: document.getElementById('downloadList'),
            downloadAllBtn: document.getElementById('downloadAllBtn'),
            errorBox: document.getElementById('errorBox')
        };
        
        els.uploadArea.addEventListener('click', () => els.fileInput.click());
        els.uploadArea.addEventListener('dragover', e => { e.preventDefault(); els.uploadArea.classList.add('dragover'); });
        els.uploadArea.addEventListener('dragleave', () => els.uploadArea.classList.remove('dragover'));
        els.uploadArea.addEventListener('drop', e => { e.preventDefault(); els.uploadArea.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); });
        els.fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });
        els.chunkSize.addEventListener('input', updateEstimate);
        els.splitBtn.addEventListener('click', splitFile);
        els.downloadAllBtn.addEventListener('click', downloadAllAsZip);
        
        function handleFile(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            if (ext !== 'ogg' && ext !== 'mp3') return showError('Nur OGG/MP3!');
            selectedFile = file;
            originalFilename = file.name.substring(0, file.name.lastIndexOf('.'));
            els.fileInfo.innerHTML = '<p><strong>Datei:</strong> ' + file.name + '</p><p><strong>Gr√∂√üe:</strong> ' + formatSize(file.size) + '</p>';
            els.fileInfo.classList.add('visible');
            els.splitBtn.disabled = false;
            updateEstimate();
        }
        
        function updateEstimate() {
            if (!selectedFile) return;
            els.estimatedChunks.value = Math.ceil(selectedFile.size / (parseInt(els.chunkSize.value) * 1024));
        }
        
        async function splitFile() {
            els.results.classList.remove('visible');
            els.progressBar.classList.add('visible');
            els.splitBtn.disabled = true;
            chunks = [];
            
            try {
                const chunkSize = parseInt(els.chunkSize.value) * 1024;
                const fileData = await selectedFile.arrayBuffer();
                const totalChunks = Math.ceil(fileData.byteLength / chunkSize);
                
                const ext = selectedFile.name.split('.').pop().toLowerCase();
                for (let i = 0; i < totalChunks; i++) {
                    const start = i * chunkSize;
                    const end = Math.min(start + chunkSize, fileData.byteLength);
                    chunks.push({
                        filename: originalFilename + '_part_' + String(i + 1).padStart(3, '0') + '.' + ext,
                        data: fileData.slice(start, end),
                        size: end - start
                    });
                    updateProgress(Math.round(((i + 1) / totalChunks) * 50));
                }
                
                updateProgress(75, 'Player erstellen...');
                playerHTML = createPlayerHTML();
                updateProgress(100);
                displayDownloads();
                setTimeout(() => { els.progressBar.classList.remove('visible'); els.results.classList.add('visible'); }, 500);
            } catch (error) {
                showError('Fehler: ' + error.message);
                els.splitBtn.disabled = false;
            }
        }
        
        function createPlayerHTML() {
            const ext = selectedFile.name.split('.').pop().toLowerCase();
            const mime = ext === 'mp3' ? 'audio/mpeg' : 'audio/ogg';
            
            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>' + selectedFile.name + '</title>';
            html += '<style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}';
            html += '.container{background:#fff;border-radius:20px;padding:40px;max-width:600px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3)}h1{text-align:center;margin-bottom:20px}';
            html += '.upload{border:3px dashed #667eea;border-radius:15px;padding:40px;text-align:center;background:#f8f9ff;cursor:pointer;margin-bottom:20px}';
            html += '.upload:hover{background:#f0f2ff}.upload.hide{display:none}';
            html += '.controls{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:15px;padding:30px;text-align:center;display:none}';
            html += '.controls.show{display:block}.progress{width:100%;height:8px;background:rgba(255,255,255,.3);border-radius:4px;margin:20px 0;cursor:pointer}';
            html += '.progress-fill{height:100%;background:#fff;width:0%;transition:width .1s}.times{display:flex;justify-content:space-between;color:#fff;font-size:.9em}';
            html += '.buttons{display:flex;justify-content:center;gap:20px;margin:20px 0}button{background:#fff;border:none;width:50px;height:50px;border-radius:50%;cursor:pointer;font-size:20px}';
            html += 'button:hover{transform:scale(1.1)}.play{width:60px;height:60px;font-size:24px}.status{color:#fff;margin:10px 0;font-size:0.9em}input[type=range]{width:100%;margin-top:15px}</style></head>';
            html += '<body><div class="container"><h1>' + selectedFile.name + '</h1>';
            html += '<div class="upload" id="upload" onclick="document.getElementById(\'files\').click()"><div style="font-size:3em;margin-bottom:10px">üìÅ</div>';
            html += '<div style="font-size:1.2em;color:#667eea;font-weight:600;margin-bottom:10px">Chunks hier ablegen oder klicken</div>';
            html += '<div style="color:#999;font-size:0.9em">W√§hle alle ' + chunks.length + ' Chunk-Dateien aus</div>';
            html += '<input type="file" id="files" multiple accept=".ogg,.mp3" style="display:none"></div>';
            html += '<div class="controls" id="controls"><div class="progress" id="bar"><div class="progress-fill" id="fill"></div></div>';
            html += '<div class="times"><span id="curr">0:00</span><span id="total">0:00</span></div><div class="buttons"><button onclick="seek(-10)">‚èÆ</button>';
            html += '<button class="play" id="play" onclick="toggle()">‚ñ∂</button><button onclick="seek(10)">‚è≠</button></div>';
            html += '<div class="status" id="status">Bereit</div><input type="range" id="vol" min="0" max="100" value="100" oninput="audio.volume=this.value/100"></div></div>';
            html += '<script>';
            html += 'const MIME="' + mime + '",EXPECTED=' + chunks.length + ';';
            html += 'let play=false;const audio=new Audio(),els={upload:document.getElementById("upload"),controls:document.getElementById("controls"),play:document.getElementById("play"),fill:document.getElementById("fill"),bar:document.getElementById("bar"),curr:document.getElementById("curr"),total:document.getElementById("total"),status:document.getElementById("status"),files:document.getElementById("files")};';
            html += 'els.upload.addEventListener("dragover",e=>{e.preventDefault();els.upload.style.background="#e8ebff"});';
            html += 'els.upload.addEventListener("dragleave",()=>els.upload.style.background="#f8f9ff");';
            html += 'els.upload.addEventListener("drop",e=>{e.preventDefault();els.upload.style.background="#f8f9ff";if(e.dataTransfer.files.length>0)handleFiles(e.dataTransfer.files)});';
            html += 'els.files.addEventListener("change",e=>{if(e.target.files.length>0)handleFiles(e.target.files)});';
            html += 'async function handleFiles(files){const binFiles=Array.from(files).filter(f=>f.name.endsWith(".ogg")||f.name.endsWith(".mp3"));';
            html += 'if(binFiles.length!==EXPECTED){alert("Bitte alle "+EXPECTED+" Chunk-Dateien ausw√§hlen! (Gefunden: "+binFiles.length+")");return}';
            html += 'binFiles.sort((a,b)=>a.name.localeCompare(b.name));els.upload.classList.add("hide");els.controls.classList.add("show");';
            html += 'els.status.textContent="Lade "+binFiles.length+" Chunks...";const chunks=[];';
            html += 'for(let i=0;i<binFiles.length;i++){const data=await binFiles[i].arrayBuffer();chunks.push(new Uint8Array(data));els.status.textContent="Geladen: "+(i+1)+"/"+binFiles.length}';
            html += 'const total=chunks.reduce((s,c)=>s+c.length,0);const merged=new Uint8Array(total);let offset=0;';
            html += 'chunks.forEach(c=>{merged.set(c,offset);offset+=c.length});els.status.textContent="F√ºge zusammen...";';
            html += 'const blob=new Blob([merged],{type:MIME});audio.src=URL.createObjectURL(blob);els.status.textContent="Bereit zum Abspielen ‚úì"}';
            html += 'function toggle(){if(play){audio.pause();els.play.textContent="‚ñ∂";play=false;els.status.textContent="Pausiert"}else{audio.play();els.play.textContent="‚è∏";play=true;els.status.textContent="Spielt ab..."}}';
            html += 'function seek(s){audio.currentTime+=s}';
            html += 'function fmt(s){if(isNaN(s))return "0:00";const m=Math.floor(s/60),sec=Math.floor(s%60);return m+":"+(sec<10?"0":"")+sec}';
            html += 'audio.addEventListener("ended",()=>{play=false;els.play.textContent="‚ñ∂";els.status.textContent="Beendet"});';
            html += 'audio.addEventListener("timeupdate",()=>{const p=(audio.currentTime/audio.duration)*100||0;els.fill.style.width=p+"%";els.curr.textContent=fmt(audio.currentTime)});';
            html += 'audio.addEventListener("loadedmetadata",()=>els.total.textContent=fmt(audio.duration));';
            html += 'els.bar.addEventListener("click",e=>{const r=els.bar.getBoundingClientRect();audio.currentTime=((e.clientX-r.left)/r.width)*audio.duration});';
            html += 'document.addEventListener("keydown",e=>{if(e.code==="Space"&&audio.src){e.preventDefault();toggle()}else if(e.code==="ArrowLeft")seek(-10);else if(e.code==="ArrowRight")seek(10)});';
            html += '<\/script></body></html>';
            
            return html;
        }
        
        function displayDownloads() {
            var html = '<div class="download-item player"><div class="file-info"><div class="file-name">Player: ' + originalFilename + '_player.html</div><div class="file-size">HTML</div></div>';
            html += '<button class="download-btn" onclick="downloadPlayer()">Download</button></div>';
            
            chunks.forEach((c, i) => {
                html += '<div class="download-item"><div class="file-info"><div class="file-name">' + c.filename + '</div><div class="file-size">' + formatSize(c.size) + '</div></div>';
                html += '<button class="download-btn" onclick="downloadChunk(' + i + ')">Download</button></div>';
            });
            
            els.downloadList.innerHTML = html;
        }
        
        window.downloadPlayer = () => saveAs(new Blob([playerHTML], {type: 'text/html'}), originalFilename + '_player.html');
        window.downloadChunk = i => saveAs(new Blob([chunks[i].data]), chunks[i].filename);
        
        async function downloadAllAsZip() {
            els.downloadAllBtn.disabled = true;
            els.downloadAllBtn.textContent = 'Erstelle ZIP...';
            const zip = new JSZip();
            zip.file(originalFilename + '_player.html', playerHTML);
            chunks.forEach(c => zip.file(c.filename, c.data));
            const blob = await zip.generateAsync({type: 'blob'});
            saveAs(blob, originalFilename + '_chunks.zip');
            els.downloadAllBtn.disabled = false;
            els.downloadAllBtn.textContent = 'Alle als ZIP';
        }
        
        function updateProgress(p, t) {
            els.progressFill.style.width = p + '%';
            els.progressFill.textContent = t || p + '%';
        }
        
        function showError(msg) {
            els.errorBox.textContent = msg;
            els.errorBox.classList.add('visible');
            els.progressBar.classList.remove('visible');
        }
        
        function formatSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
